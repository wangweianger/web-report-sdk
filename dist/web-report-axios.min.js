"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};function randomString(len){len=len||10;for(var $chars="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz123456789",maxPos=$chars.length,pwd="",i=0;i<len;i++)pwd+=$chars.charAt(Math.floor(Math.random()*maxPos));return pwd+(new Date).getTime()}function Performance(option,fn){try{var reportData=function(){var type=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1;setTimeout(function(){opt.isPage&&perforPage(),(opt.isResource||opt.isAjax)&&perforResource(),ERRORLIST&&ERRORLIST.length&&(conf.errorList=conf.errorList.concat(ERRORLIST));var w=document.documentElement.clientWidth||document.body.clientWidth,h=document.documentElement.clientHeight||document.body.clientHeight,markuser=function(){var markUser=sessionStorage.getItem("ps_markUser")||"",result={markUser:markUser,isFristIn:!1};return markUser||(markUser=randomString(),sessionStorage.setItem("ps_markUser",markUser),result.markUser=markUser,result.isFristIn=!0),result}(),result={time:(new Date).getTime(),addData:ADDDATA,markUser:markuser.markUser,markUv:function(){var date=new Date,markUv=localStorage.getItem("ps_markUv")||"",datatime=localStorage.getItem("ps_markUvTime")||"",today=date.getFullYear()+"/"+(date.getMonth()+1)+"/"+date.getDate()+" 23:59:59";return(!markUv&&!datatime||date.getTime()>1*datatime)&&(markUv=randomString(),localStorage.setItem("ps_markUv",markUv),localStorage.setItem("ps_markUvTime",new Date(today).getTime())),markUv}(),type:type};!function(){var reslist=conf.resourceList,filterUrl=opt.filterUrl,newlist=[];if(reslist&&reslist.length&&filterUrl&&filterUrl.length)for(var i=0;i<reslist.length;i++){for(var begin=!1,j=0;j<filterUrl.length;j++)if(-1<reslist[i].name.indexOf(filterUrl[j])){begin=!0;break}begin||newlist.push(reslist[i])}conf.resourceList=newlist}(),1===type?result=Object.assign(result,{preUrl:conf.preUrl,errorList:conf.errorList,performance:conf.performance,resourceList:conf.resourceList,isFristIn:markuser.isFristIn,screenwidth:w,screenheight:h}):2===type?result=Object.assign(result,{resourceList:conf.resourceList,errorList:conf.errorList}):3===type&&(result=Object.assign(result,{errorList:conf.errorList,resourceList:conf.resourceList})),result=Object.assign(result,opt.add),fn&&fn(result),!fn&&window.fetch&&fetch(opt.domain,{method:"POST",headers:{"Content-Type":"application/json"},type:"report-data",body:JSON.stringify(result)}),Promise.resolve().then(function(){clear()})},opt.outtime)},getLargeTime=function(){conf.page!==location.href?conf.haveAjax&&loadTime&&ajaxTime?reportData(1):!conf.haveAjax&&loadTime&&reportData(1):conf.haveAjax&&ajaxTime&&reportData(2)},perforPage=function(){if(window.performance){var timing=performance.timing;conf.performance={dnst:timing.domainLookupEnd-timing.domainLookupStart||0,tcpt:timing.connectEnd-timing.connectStart||0,wit:timing.responseStart-timing.navigationStart||0,domt:timing.domContentLoadedEventEnd-timing.navigationStart||0,lodt:timing.loadEventEnd-timing.navigationStart||0,radt:timing.fetchStart-timing.navigationStart||0,rdit:timing.redirectEnd-timing.redirectStart||0,uodt:timing.unloadEventEnd-timing.unloadEventStart||0,reqt:timing.responseEnd-timing.requestStart||0,andt:timing.domComplete-timing.domInteractive||0}}},perforResource=function(){if(!window.performance&&!window.performance.getEntries)return!1;var resource=performance.getEntriesByType("resource"),resourceList=[];if(!resource&&!resource.length)return resourceList;resource.forEach(function(item){if((opt.isAjax||"xmlhttprequest"!=item.initiatorType&&"fetchrequest"!=item.initiatorType)&&(opt.isResource||"xmlhttprequest"==item.initiatorType||"fetchrequest"===item.initiatorType)){var json={name:item.name,method:"GET",type:item.initiatorType,duration:item.duration.toFixed(2)||0,decodedBodySize:item.decodedBodySize||0,nextHopProtocol:item.nextHopProtocol};if(conf.ajaxMsg&&conf.ajaxMsg.length)for(var i=0,len=conf.ajaxMsg.length;i<len;i++)conf.ajaxMsg[i].url===item.name&&(json.method=conf.ajaxMsg[i].method||"GET",json.type=conf.ajaxMsg[i].type||json.type,json.options=conf.ajaxMsg[i].options||"");resourceList.push(json)}}),conf.resourceList=resourceList},ajaxArg=function(arg,item){var result={method:"GET",type:"xmlhttprequest",report:""},args=Array.prototype.slice.apply(arg);try{"axios"==item||"request"==item?(result.url=args[0].url,result.method=args[0].method,result.options="get"==result.method.toLowerCase()?args[0].params:args[0].data):(result.url=args[0],result.method="",args[1]&&(args[1].params?(result.method="GET",result.options=args[1].params):(result.method="POST",result.options=args[1]))),result.report=args[0].report}catch(err){}return result},ajaxResponse=function(xhr,type){var defaults=Object.assign({},errordefo);defaults.t=(new Date).getTime(),defaults.n="ajax",defaults.msg=xhr.statusText||"ajax request error",defaults.method=xhr.method,defaults.options=xhr.options,defaults.data={resourceUrl:xhr.responseURL,text:xhr.statusText,status:xhr.status},conf.errorList.push(defaults)},getAjaxTime=function(type){conf.loadNum+=1,conf.loadNum===conf.ajaxLength&&(conf.ajaxLength=conf.loadNum=0,ajaxTime=(new Date).getTime()-beginTime,getLargeTime())},clear=function(){window.performance&&window.performance.clearResourceTimings&&performance.clearResourceTimings(),conf.performance={},conf.errorList=[],conf.preUrl="",conf.resourceList=[],conf.page=location.href,conf.haveAjax=!1,ERRORLIST=[],ADDDATA={},ajaxTime=0},opt={domain:"http://localhost/api",outtime:300,filterUrl:[],isPage:!0,isAjax:!0,isResource:!0,isError:!0,add:{}};(opt=Object.assign(opt,option)).filterUrl=opt.filterUrl.concat(["/api/v1/report/web","livereload.js?snipver=1","/sockjs-node/info"]);var conf={resourceList:[],performance:{},errorList:[],loadNum:0,ajaxLength:0,ajaxMsg:[],goingType:"",haveAjax:!1,preUrl:document.referrer&&document.referrer!==location.href?document.referrer:"",page:""},errordefo={t:"",n:"js",msg:"",data:{}},beginTime=(new Date).getTime(),loadTime=0,ajaxTime=0;opt.isError&&(window.addEventListener("error",function(e){var defaults=Object.assign({},errordefo);defaults.n="resource",defaults.t=(new Date).getTime(),defaults.msg=e.target.localName+" is load error",defaults.method="GET",defaults.data={target:e.target.localName,type:e.type,resourceUrl:e.target.href||e.target.currentSrc},e.target!=window&&conf.errorList.push(defaults)},!0),window.onerror=function(msg,_url,line,col,error){var defaults=Object.assign({},errordefo);setTimeout(function(){col=col||window.event&&window.event.errorCharacter||0,defaults.msg=error&&error.stack?error.stack.toString():msg,defaults.method="GET",defaults.data={resourceUrl:_url,line:line,col:col},defaults.t=(new Date).getTime(),conf.errorList.push(defaults),conf.page!==location.href||conf.haveAjax||reportData(3)},0)},window.addEventListener("unhandledrejection",function(e){var col,error=e&&e.reason,message=error.message||"",stack=error.stack||"",resourceUrl=void 0,line=void 0,errs=stack.match(/\(.+?\)/);errs&&errs.length&&(errs=errs[0]),(errs=(errs=errs.replace(/\w.+[js|html]/g,function($1){return resourceUrl=$1,""})).split(":"))&&1<errs.length&&(line=parseInt(errs[1]||0)),col=parseInt(errs[2]||0);var defaults=Object.assign({},errordefo);defaults.msg=message,defaults.method="GET",defaults.t=(new Date).getTime(),defaults.data={resourceUrl:resourceUrl,line:col,col:line},conf.errorList.push(defaults),conf.page!==location.href||conf.haveAjax||reportData(3)})),addEventListener("load",function(){loadTime=(new Date).getTime()-beginTime,getLargeTime()},!1),(opt.isAjax||opt.isError)&&function(){if(window.axios){var _axios=window.axios;["axios","request","get","delete","head","options","put","post","patch"].forEach(function(item){!function(item){var _key=null;function resetFn(){var result=ajaxArg(arguments,item);return"report-data"!==result.report&&(conf.ajaxMsg.push(result),conf.ajaxLength=conf.ajaxLength+1,conf.haveAjax=!0),_key.apply(this,arguments).then(function(res){return"report-data"===result.report||getAjaxTime("load"),res}).catch(function(err){return"report-data"===result.report?res:(getAjaxTime("error"),ajaxResponse({statusText:err.message,method:result.method,responseURL:result.url,options:result.options,status:err.response?err.response.status:0}),err)})}_key="axios"===item?(window.axios=resetFn,_axios):"request"===item?(window.axios.request=resetFn,_axios.request):(window.axios[item]=resetFn,_axios[item])}(item)})}}()}catch(err){}}"function"==typeof require&&"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"object"===("undefined"==typeof module?"undefined":_typeof(module))?module.exports=Performance:window.Performance=Performance,window.ERRORLIST=[],window.ADDDATA={},Performance.addError=function(err){err={method:"GET",msg:err.msg,n:"js",data:{col:err.col,line:err.line,resourceUrl:err.resourceUrl}},ERRORLIST.push(err)},Performance.addData=function(fn){fn&&fn(ADDDATA)};